---
import PageLayout from '../layouts/BaseLayout.astro'
import Section from '../components/Section.astro'
import ProjectCard from '../components/ProjectCard.astro'
import PostPreview from '@/components/blog/PostPreview.astro'
import GeometricDivider from '@/components/GeometricDivider.astro'
import FlippableProfile from '@/components/FlippableProfile.astro'

import { getAllPosts, sortMDByDate } from '@/utils'

const MAX_POSTS = 10
const allPosts = await getAllPosts()
const sortedPosts = sortMDByDate(allPosts)
// Put pinned posts first, then sort by date
const allPostsByDate = [
	...sortedPosts.filter((p) => p.data.pinned),
	...sortedPosts.filter((p) => !p.data.pinned)
].slice(0, MAX_POSTS)
---

<PageLayout meta={{ title: 'Home' }} showModeToggle={true}>
	<div class='flex w-full flex-col gap-y-10'>
		<section class='flex flex-col items-center gap-y-4'>
			<FlippableProfile size='lg' />

			<h1
				class='font-cormorant text-5xl font-semibold tracking-wide text-foreground'
				data-mode='professional'
			>
				Thariq Shihipar
			</h1>

			<h1
				class='font-cormorant text-5xl font-semibold tracking-wide text-foreground'
				data-mode='personal'
			>
				Thariq
			</h1>
		</section>

		<Section title='About' data-mode='professional'>
			<div class='flex flex-col gap-y-5 font-garamond text-xl leading-loose'>
				<p>Engineer & serial entrepreneur. Currently working on Claude Code at Anthropic.</p>
				<p>
					In past lives I've founded <a
						class='illuminated-link font-medium text-foreground'
						href='https://www.playmultiverse.com'>a YC backed gaming company that raised $17MM</a
					>, <a
						class='illuminated-link font-medium text-foreground'
						href='https://techcrunch.com/2013/03/28/hubspot-acquires-chime-prepwork/'
						>sold a SAAS startup</a
					>, <a class='illuminated-link font-medium text-foreground' href='https://www.pubpub.org/'
						>made a non-profit</a
					>, and did gradschool at the MIT Media Lab.
				</p>
			</div>
		</Section>

		<Section title='About' data-mode='personal'>
			<div class='flex flex-col gap-y-5 font-garamond text-xl leading-loose'>
				<p>Trying to pay attention.</p>
			</div>
		</Section>

		{
			allPostsByDate.length > 0 && (
				<>
					<GeometricDivider variant='simple' />

					<!-- Professional mode posts (exclude spiritual) -->
					<Section title='Posts' data-mode='professional'>
						<ul class='flex flex-col gap-y-4'>
							{allPostsByDate
								.filter((p) => !p.data.tags.includes('hidden') && !p.data.tags.includes('spiritual'))
								.map((p) => (
									<PostPreview post={p} />
								))}
						</ul>
					</Section>

					<!-- Personal mode posts (only spiritual) -->
					<Section title='Posts' data-mode='personal'>
						<ul class='flex flex-col gap-y-4'>
							{allPostsByDate
								.filter((p) => !p.data.tags.includes('hidden') && p.data.tags.includes('spiritual'))
								.map((p) => (
									<PostPreview post={p} />
								))}
						</ul>
					</Section>
				</>
			)
		}

		<GeometricDivider variant='mandala' data-mode='professional' />

		<Section title="Stuff I've Made" data-mode='professional'>
			<div class='grid grid-cols-3 gap-4'>
				{
					/* 
				<ProjectCard
					href='https://x.com/trq212/status/1833274377640829070'
					heading='Zaphod'
					subheading="I'm working on a (soon to be) open source AI coding agent."
					imagePath='/src/assets/zaphod.png'
					altText='Example'
					class='w-full'
				/>
				*/
				}

				<ProjectCard
					heading='One More Multiverse'
					href='https://www.playmultiverse.com'
					subheading=`A YC backed gaming company that I ran for 5 years. We scaled to over a million users, went viral on tiktok.
					
					`
					imagePath='/src/assets/multiverse1.jpg'
					altText=''
					class='w-full'
				/>
				<ProjectCard
					href='https://latentlit.goodfire.ai'
					heading='LatentLit'
					subheading='A tool for creating and sharing LLM-powered AI agents.'
					imagePath='/src/assets/latentlit-small.gif'
					altText='Example'
					class='w-full'
				/>
				<ProjectCard
					href='https://quickedits.thariq.io'
					heading='Quick Edit'
					subheading='AI Copyediting with great UX.'
					imagePath='/src/assets/quickedit-small.gif'
					altText='Example'
					class='w-full'
				/>
				<ProjectCard
					href='/blog/sherpa'
					heading='Sherpa'
					subheading='An email agent that prioritizes your emails based on your contacts and goals.'
					imagePath='/src/assets/sheep.jpeg'
					altText='Example'
					class='w-full'
					tags={[
						{
							text: 'Prototype',
							color: '#ef4444'
						}
					]}
				/>
				<ProjectCard
					href='/blog/worldbuilding'
					heading='AI World Building'
					subheading='An experiment in AI-aided world building for roleplaying games.'
					imagePath='/src/assets/worldbuilding2.png'
					altText='Example'
					class='w-full'
					tags={[
						{
							text: 'Prototype',
							color: '#ef4444'
						}
					]}
				/>
				<ProjectCard
					heading='Edgeout.gg'
					href='https://blitz.gg'
					subheading=`A bootstrapped gaming analytics platform I made. Sold to blitz.gg`
					imagePath='/src/assets/edgeout.png'
					altText=''
					class='w-full'
					tags={[
						{
							text: 'Acquisition',
							color: '#22c55e'
						}
					]}
				/>
				<ProjectCard
					heading='Pubpub.org'
					href='https://pubpub.org'
					subheading='A non-profit academic publishing platform that I co-founded.'
					imagePath='/src/assets/pubpub.jpeg'
					altText=''
					class='w-full'
				/>
				<ProjectCard
					heading='Chime'
					href='https://techcrunch.com/2013/03/28/hubspot-acquires-chime-prepwork/'
					subheading='A startup that I co-founded in undergrad and was acquired by Hubspot.'
					imagePath='/src/assets/chime.png'
					altText=''
					class='w-full'
					tags={[
						{
							text: 'Acquisition',
							color: '#22c55e'
						}
					]}
					hackerNewsId='5176630'
				/>
			</div>
		</Section>
	</div>
</PageLayout>

<script>
	// Get current site mode from URL parameter
	function getSiteMode(): 'professional' | 'personal' {
		if (typeof window !== 'undefined') {
			const params = new URLSearchParams(window.location.search)
			const mode = params.get('mode')
			if (mode === 'personal' || mode === 'professional') {
				return mode
			}
		}
		return 'personal'
	}

	// Filter all content based on site mode
	function filterContent() {
		const mode = getSiteMode()

		// Filter sections with data-mode attribute (but not toggle buttons)
		const modedSections = document.querySelectorAll(
			'section[data-mode], div[data-mode], h1[data-mode]'
		)
		modedSections.forEach((section) => {
			const sectionMode = (section as HTMLElement).dataset.mode
			if (sectionMode === mode) {
				;(section as HTMLElement).style.removeProperty('display')
			} else {
				;(section as HTMLElement).style.display = 'none'
			}
		})
	}

	// Handle browser back/forward navigation
	function handlePopState() {
		filterContent()
	}

	// Initialize on page load
	document.addEventListener('DOMContentLoaded', () => {
		filterContent()
		// Listen for browser back/forward
		window.addEventListener('popstate', handlePopState)
	})

	// Listen for mode changes
	document.addEventListener('mode-change', () => {
		filterContent()
	})

	// Handle Astro view transitions
	document.addEventListener('astro:page-load', () => {
		filterContent()
	})

	// Run immediately on script load
	if (document.readyState === 'loading') {
		// Still loading, wait for DOMContentLoaded (already set up above)
	} else {
		// Already loaded, run immediately
		filterContent()
	}
</script>
