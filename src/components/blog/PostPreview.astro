---
import type { HTMLTag, Polymorphic } from 'astro/types'
import type { CollectionEntry } from 'astro:content'

import FormattedDate from '../FormattedDate.astro'
import HackerNewsScore from '../HackerNewsScore.jsx'

type Props<Tag extends HTMLTag> = {
	post: CollectionEntry<'post'>
	withDesc?: boolean
}

const { as: Tag = 'div', post, withDesc = false } = Astro.props
const postDate = post.data.updatedDate ?? post.data.publishDate

const { remarkPluginFrontmatter } = await post.render()
---

<li class='flex items-baseline justify-between gap-4'>
	<Tag class='flex flex-col gap-1'>
		<div class='flex items-center gap-2'>
			{post.data.pinned && <span class='text-gold/60 text-xs' title='Pinned'>&#x2726;</span>}
			{post.data.draft && <span class='text-red-500 text-sm font-medium'>(Draft) </span>}
			<a
				data-astro-prefetch
				href={`/blog/${post.slug}/`}
				class='font-cormorant text-lg font-semibold illuminated-link'
			>
				{post.data.title}
			</a>
			<span class='text-xs text-muted-foreground'>Â· {remarkPluginFrontmatter.minutesRead}</span>
			{post.data.hackerNewsId && <HackerNewsScore id={post.data.hackerNewsId} client:load />}
		</div>
		{
			withDesc && (
				<p class='line-clamp-3 block text-sm leading-relaxed text-muted-foreground'>
					{post.data.description}
				</p>
			)
		}
	</Tag>
	<FormattedDate class='shrink-0 text-sm text-muted-foreground' date={postDate} />
</li>
